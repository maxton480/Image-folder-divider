<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Folder Divider</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
body{
  font-family: Arial, sans-serif;
  background:#0f172a;
  color:white;
  text-align:center;
  padding:20px;
}
.container{
  max-width:500px;
  margin:auto;
  background:#1e293b;
  padding:20px;
  border-radius:12px;
}
input, button{
  width:100%;
  padding:12px;
  margin:10px 0;
  border:none;
  border-radius:8px;
}
input{
  background:#334155;
  color:white;
}
button{
  background:#6366f1;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
button:hover{
  background:#4f46e5;
}
.progress-bar{
  width:100%;
  background:#334155;
  border-radius:8px;
  overflow:hidden;
  margin-top:15px;
}
.progress{
  height:15px;
  width:0%;
  background:#22c55e;
}
</style>
</head>
<body>

<div class="container">
<h2>Image Folder Divider ðŸ”¥</h2>

<input type="text" id="mainFolder" placeholder="Enter Folder Name (example: 91)" required>
<input type="file" id="images" multiple accept="image/*">

<button onclick="processImages()">Process & Download ZIP</button>

<div class="progress-bar">
<div class="progress" id="progress"></div>
</div>

<p id="status"></p>
</div>

<script>
async function processImages(){
  const folderName = document.getElementById("mainFolder").value.trim();
  const files = document.getElementById("images").files;
  const progress = document.getElementById("progress");
  const status = document.getElementById("status");

  if(!folderName || files.length === 0){
    alert("Please enter folder name and select images.");
    return;
  }

  const zip = new JSZip();
  const mainFolder = zip.folder(folderName);

  let count = 0;
  let folderIndex = 1;

  for(let i = 0; i < files.length; i++){
    if(i % 10 === 0 && i !== 0){
      folderIndex++;
    }

    const subFolderName = `${folderIndex} (${folderName})`;
    const subFolder = mainFolder.folder(subFolderName);

    const file = files[i];
    const webpBlob = await convertToWebP(file);

    count++;
    const fileName = String(count).padStart(3,'0') + ".webp";
    subFolder.file(fileName, webpBlob);

    let percent = Math.round(((i+1)/files.length)*100);
    progress.style.width = percent + "%";
    status.innerText = `Processing ${i+1} / ${files.length}`;
  }

  status.innerText = "Creating ZIP...";

  zip.generateAsync({type:"blob"}).then(function(content){
    const link = document.createElement("a");
    link.href = URL.createObjectURL(content);
    link.download = folderName + ".zip";
    link.click();
    status.innerText = "Download Ready âœ…";
  });
}

function convertToWebP(file){
  return new Promise((resolve)=>{
    const img = new Image();
    const reader = new FileReader();

    reader.onload = function(e){
      img.src = e.target.result;
    };

    img.onload = function(){
      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img,0,0);

      canvas.toBlob(function(blob){
        resolve(blob);
      }, "image/webp", 0.9);
    };

    reader.readAsDataURL(file);
  });
}
</script>

</body>
</html>
